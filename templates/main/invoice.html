{% extends 'main/base.html' %}
{% load static %}
{% block content %}
<div class="order-invoice-container">
    <div class="invoice-header">
        <h2>Order Invoice</h2>
        <div class="header-actions">
            <button class="btn btn-primary" onclick="printReceipt()">
                <i class="fas fa-print"></i> Print Receipt
            </button>
            <a href="{% url 'home' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to Orders
            </a>
        </div>
    </div>

    <div class="invoice-content">
        <div class="receipt-section">
            <div class="receipt-container">
                <div class="social-media">
                    <i class="fab fa-instagram"></i> @focusstreetkitchen
                </div>
                
                <img src="{% static 'focuslogo.jpg' %}" alt="Logo" class="logo-img" />

                <div class="header">
                    <h1>Focus Street Kitchen</h1>
                    <p><i class="fas fa-map-marker-alt"></i> Takoradi, BU Ridge</p>
                    <p><i class="fas fa-phone"></i> 0592767499 • 0540289118</p>
                </div>

                <div class="receipt-title">
                    <h2><i class="fas fa-file-invoice"></i> ORDER RECEIPT <i class="fas fa-file-invoice"></i></h2>
                    <p>Order #{{ order.id }} • {{ order.created_at|date:"M d, Y" }}</p>
                </div>

                <div class="customer-info">
                    {% if order.customer.name %}
                    <div class="info-row">
                        <span class="info-label">Customer:</span>
                        <span>{{ order.customer.name }}</span>
                    </div>
                    {% endif %}
                    {% if order.customer.phone_number %}
                    <div class="info-row">
                        <span class="info-label">Phone:</span>
                        <span>{{ order.customer.phone_number }}</span>
                    </div>
                    {% endif %}

                
                </div>

                <table class="items-table">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Qty</th>
                            <th>Price</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in order.items.all %}
                        <tr>
                            <td class="item-name">{{ item.product.name }}</td>
                            <td class="item-qty">{{ item.quantity }}</td>
                            <td class="item-price">₵{{ item.product.selling_price }}</td>
                            <td class="item-total">₵{{ item.get_total_product_price }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <div class="total-section">
                    <div class="total-row">
                        <span>Subtotal:</span>
                        <span>₵{{ order.total_price }}</span>
                    </div>
                    <div class="total-row grand-total">
                        <span>TOTAL:</span>
                        <span>₵{{ order.total_price }}</span>
                    </div>
                </div>

                <div class="footer">
                    <div class="thank-you">
                        <i class="fas fa-heart"></i> THANK YOU! <i class="fas fa-heart"></i>
                    </div>
                    <p>We appreciate your business!</p>
                </div>
            </div>
        </div>

        <div class="rider-section">
            <div class="rider-card">
                <h3>Rider Assignment</h3>
                {% if order.rider %}
                <div class="assigned-rider">
                    <div class="rider-info">
                        <div class="rider-avatar">
                            <i class="fas fa-motorcycle"></i>
                        </div>
                        <div class="rider-details">
                            <h4>{{ order.rider.name }}</h4>
                            <p>{{ order.rider.phne_number }}</p>
                           
                        </div>
                    </div>
                    <div class="rider-actions">
                        <button class="btn btn-outline" onclick="changeRider()">
                            <i class="fas fa-sync"></i> Change
                        </button>
                        <button class="btn btn-danger" onclick="removeRider()">
                            <i class="fas fa-times"></i> Remove
                        </button>
                    </div>
                </div>
                {% else %}
                <div class="no-rider">
                    <div class="no-rider-icon">
                        <i class="fas fa-motorcycle"></i>
                    </div>
                    <p>No rider assigned to this order</p>
                    <button class="btn btn-primary" onclick="assignRider()">
                        <i class="fas fa-plus"></i> Assign Rider
                    </button>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div id="assignRiderModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Assign Rider to Order</h3>
            <button class="modal-close" onclick="closeModal('assignRiderModal')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="rider-selection-tabs">
                <button class="tab-btn active" onclick="switchTab('existing')">Select Existing Rider</button>
                <button class="tab-btn" onclick="switchTab('new')">Create New Rider</button>
            </div>

            <div id="existingRiderTab" class="tab-content active">
                <div class="search-box">
                    <input type="text" id="riderSearch" placeholder="Search riders...">
                    <i class="fas fa-search"></i>
                </div>
                <div class="riders-list" id="ridersList">
                    {% for rider in riders %}
                    <div class="rider-option" onclick="selectRider('{{ rider.id }}', '{{ rider.name }}', '{{ rider.phne_number }}')">
                        <div class="rider-option-avatar">
                            <i class="fas fa-motorcycle"></i>
                        </div>
                        <div class="rider-option-info">
                            <h4>{{ rider.name }}</h4>
                            <p>{{ rider.phne_number }}</p>
                        </div>
                        <div class="rider-option-action">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div id="newRiderTab" class="tab-content">
                <form id="newRiderForm">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="riderName">Rider Name</label>
                        <input type="text" id="riderName" class="form-control" placeholder="Enter rider name">
                    </div>
                    <div class="form-group">
                        <label for="riderPhone">Phone Number</label>
                        <input type="text" id="riderPhone" class="form-control" placeholder="Enter phone number">
                    </div>
                    <div class="form-group">
                        <label for="idCardNumber">ID Card Number (Optional)</label>
                        <input type="text" id="idCardNumber" class="form-control" placeholder="Enter ID card number">
                    </div>
                    <div class="form-group">
                        <label for="idImage">Upload ID Image (Optional)</label>
                        <div class="file-upload">
                            <input type="file" id="idImage" accept="image/*" style="display: none;">
                            <div class="file-upload-area" onclick="document.getElementById('idImage').click()">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Click to upload ID image</p>
                                <span>PNG, JPG up to 5MB</span>
                            </div>
                            <div id="fileName" class="file-name"></div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeModal('assignRiderModal')">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="confirmRiderAssignment()">Assign Rider</button>
        </div>
    </div>
</div>

<script>
function printReceipt() {
    const receipt = document.querySelector('.receipt-container').cloneNode(true);
    const printWindow = window.open('', '', 'width=400,height=600');

    printWindow.document.write(`
        <html>
        <head>
            <title>Focus Street Kitchen - Order Receipt</title>
            <style>
                @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css');
                @import url('https://fonts.googleapis.com/css2?family=Short+Stack&display=swap');
                
                body {
                    font-family: Arial, sans-serif;
                    margin: 0;
                    padding: 0;
                    font-size: 10px;
                    line-height: 1.2;
                    background: white;
                    display: flex;
                    justify-content: center;
                    align-items: flex-start;
                    min-height: 100vh;
                }
                
                .receipt-container {
                    width: 240px;
                    padding: 10px;
                    background: white;
                    border-radius: 6px;
                    border: 2px solid #8B0000;
                    position: relative;
                    overflow: hidden;
                    margin: 0 auto;
                    font-size: 10px;
                    line-height: 1.2;
                }
                
                .receipt-container .social-media {
                    text-align: center;
                    margin-bottom: 3px;
                    font-size: 8px;
                    color: #8B0000;
                }
                
                .receipt-container .logo-img {
                    width: 35px;
                    height: 35px;
                    border-radius: 50%;
                    border: 1px solid #8B0000;
                    margin: 0 auto 3px;
                    display: block;
                    object-fit: cover;
                    position: relative;
                    z-index: 1;
                    background: white;
                }
                
                .receipt-container .header {
                    text-align: center;
                    margin-bottom: 5px;
                    position: relative;
                    z-index: 1;
                }
                
                .receipt-container .header h1 {
                    color: #8B0000;
                    font-size: 12px;
                    margin: 2px 0;
                    font-weight: 700;
                    font-family: 'Short Stack', cursive;
                }
                
                .receipt-container .header p {
                    margin: 1px 0;
                    font-size: 8px;
                    color: #666;
                }
                
                .receipt-container .receipt-title {
                    text-align: center;
                    margin: 5px 0;
                    padding: 3px 0;
                    background: linear-gradient(to right, #FFF0F0, #FFFFFF, #FFF0F0);
                    border-radius: 3px;
                    position: relative;
                }
                
                .receipt-container .receipt-title h2 {
                    font-size: 10px;
                    color: #8B0000;
                    margin: 2px 0;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                
                .receipt-container .receipt-title h2 i {
                    margin: 0 2px;
                    font-size: 8px;
                }
                
                .receipt-container .receipt-title p {
                    font-size: 7px;
                    color: #777;
                    margin: 0;
                }
                
                .receipt-container .customer-info {
                    margin: 5px 0;
                    padding: 4px;
                    background: #FFF5F5;
                    border-radius: 3px;
                    font-size: 9px;
                }
                
                .receipt-container .info-row {
                    display: flex;
                    justify-content: space-between;
                    margin: 1px 0;
                }
                
                .receipt-container .info-label {
                    color: #8B0000;
                    font-weight: bold;
                }
                
                .receipt-container .items-table {
                    width: 100%;
                    border-collapse: collapse;
                    margin: 5px 0;
                    font-size: 9px;
                }
                
                .receipt-container .items-table th {
                    background: #8B0000;
                    color: white;
                    padding: 2px;
                    text-align: left;
                    font-size: 8px;
                }
                
                .receipt-container .items-table td {
                    padding: 1px 2px;
                    border-bottom: 1px solid #FFD6D6;
                }
                
                .receipt-container .items-table tr:nth-child(even) {
                    background-color: #FFF9F9;
                }
                
                .receipt-container .item-name {
                    max-width: 100px;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    white-space: nowrap;
                }
                
                .receipt-container .item-qty, 
                .receipt-container .item-price,
                .receipt-container .item-total {
                    text-align: center;
                    width: 20%;
                }
                
                .receipt-container .total-section {
                    margin-top: 5px;
                    padding-top: 5px;
                    border-top: 1px solid #8B0000;
                    font-size: 10px;
                }
                
                .receipt-container .total-row {
                    display: flex;
                    justify-content: space-between;
                    margin: 1px 0;
                }
                
                .receipt-container .grand-total {
                    font-weight: bold;
                    color: #8B0000;
                    font-size: 11px;
                    margin-top: 3px;
                    padding-top: 3px;
                    border-top: 1px solid #8B0000;
                }
                
                .receipt-container .footer {
                    text-align: center;
                    margin-top: 6px;
                    padding-top: 5px;
                    border-top: 1px solid #8B0000;
                    font-size: 9px;
                    color: #666;
                }
                
                .receipt-container .thank-you {
                    color: #8B0000;
                    font-weight: bold;
                    font-size: 10px;
                    margin: 3px 0;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                
                .receipt-container .thank-you i {
                    margin: 0 2px;
                    color: #8B0000;
                    font-size: 8px;
                }
                
                .receipt-container .footer p {
                    margin: 2px 0;
                    font-size: 8px;
                }
                
                @media print {
                    body {
                        margin: 0;
                        padding: 0;
                    }
                    .receipt-container {
                        border: none !important;
                        box-shadow: none !important;
                        margin: 0 auto !important;
                        width: 58mm !important;
                        padding: 5px !important;
                    }
                    @page {
                        size: auto;
                        margin: 0;
                    }
                }
            </style>
        </head>
        <body>
            ${receipt.outerHTML}
        </body>
        </html>
    `);

    printWindow.document.close();
    
    setTimeout(() => {
        printWindow.focus();
        printWindow.print();
        printWindow.close();
    }, 500);
}

let selectedRiderId = null;
let isNewRider = false;
let selectedFile = null;

function assignRider() {
    selectedRiderId = null;
    isNewRider = false;
    document.getElementById('assignRiderModal').style.display = 'flex';
}

function changeRider() {
    assignRider();
}

function removeRider() {
    if (confirm('Are you sure you want to remove the rider from this order?')) {
        fetch(`/order/{{ order.id }}/remove-rider/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showAlert('success', 'Rider removed successfully');
                setTimeout(() => window.location.reload(), 1000);
            } else {
                showAlert('danger', data.error || 'Failed to remove rider');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showAlert('danger', 'An error occurred while removing rider');
        });
    }
}

function switchTab(tab) {
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
    
    if (tab === 'existing') {
        document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
        document.getElementById('existingRiderTab').classList.add('active');
        isNewRider = false;
    } else {
        document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
        document.getElementById('newRiderTab').classList.add('active');
        isNewRider = true;
    }
}

function selectRider(riderId, name, phone) {
    selectedRiderId = riderId;
    document.querySelectorAll('.rider-option').forEach(option => option.classList.remove('selected'));
    event.currentTarget.classList.add('selected');
}

function confirmRiderAssignment() {
    if (!isNewRider && !selectedRiderId) {
        showAlert('danger', 'Please select a rider');
        return;
    }

    if (isNewRider) {
        const name = document.getElementById('riderName').value.trim();
        const phone = document.getElementById('riderPhone').value.trim();
        
        if (!name || !phone) {
            showAlert('danger', 'Please fill in rider name and phone number');
            return;
        }

        const formData = new FormData();
        formData.append('name', name);
        formData.append('phone_number', phone);
        formData.append('id_card', document.getElementById('idCardNumber').value.trim());
        
        if (selectedFile) {
            formData.append('id_image', selectedFile);
        }

        fetch('/create-rider/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                assignRiderToOrder(data.rider_id);
            } else {
                showAlert('danger', data.error || 'Failed to create rider');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showAlert('danger', 'An error occurred while creating rider');
        });
    } else {
        assignRiderToOrder(selectedRiderId);
    }
}

function assignRiderToOrder(riderId) {
    fetch(`/order/{{ order.id }}/assign-rider/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ rider_id: riderId })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showAlert('success', 'Rider assigned successfully');
            closeModal('assignRiderModal');
            setTimeout(() => window.location.reload(), 1000);
        } else {
            showAlert('danger', data.error || 'Failed to assign rider');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showAlert('danger', 'An error occurred while assigning rider');
    });
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

document.getElementById('idImage').addEventListener('change', function(e) {
    selectedFile = e.target.files[0];
    const fileName = document.getElementById('fileName');
    if (selectedFile) {
        fileName.textContent = selectedFile.name;
        fileName.style.display = 'block';
    } else {
        fileName.style.display = 'none';
    }
});

document.getElementById('riderSearch').addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    document.querySelectorAll('.rider-option').forEach(option => {
        const name = option.querySelector('h4').textContent.toLowerCase();
        const phone = option.querySelector('p').textContent.toLowerCase();
        if (name.includes(searchTerm) || phone.includes(searchTerm)) {
            option.style.display = 'flex';
        } else {
            option.style.display = 'none';
        }
    });
});

function showAlert(type, message) {
    const alert = document.createElement('div');
    alert.className = `alert alert-${type}`;
    alert.innerHTML = `
        ${message}
        <button class="close" onclick="this.parentElement.remove()">&times;</button>
    `;
    document.body.appendChild(alert);
    setTimeout(() => alert.remove(), 5000);
}
</script>

<style>
.order-invoice-container {
    padding: 20px;
    max-width: 1000px;
    margin: 0 auto;
}

.invoice-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    flex-wrap: wrap;
    gap: 15px;
}

.invoice-header h2 {
    margin: 0;
    color: #333;
    font-size: 1.8rem;
}

.header-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.invoice-content {
    display: grid;
    grid-template-columns: 1fr 350px;
    gap: 30px;
    align-items: start;
}

.receipt-section {
    background: white;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border: 1px solid #e0e0e0;
}

.rider-section {
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border: 1px solid #e0e0e0;
    position: sticky;
    top: 20px;
}

.rider-card h3 {
    margin-top: 0;
    margin-bottom: 20px;
    color: #333;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
}

.receipt-container {
    width: 240px;
    padding: 10px;
    background: white;
    border-radius: 6px;
    border: 2px solid #8B0000;
    position: relative;
    overflow: hidden;
    margin: 0 auto;
    font-size: 10px;
    line-height: 1.2;
}

.receipt-container .social-media {
    text-align: center;
    margin-bottom: 3px;
    font-size: 8px;
    color: #8B0000;
}

.receipt-container .logo-img {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    border: 1px solid #8B0000;
    margin: 0 auto 3px;
    display: block;
    object-fit: cover;
    position: relative;
    z-index: 1;
    background: white;
}

.receipt-container .header {
    text-align: center;
    margin-bottom: 5px;
    position: relative;
    z-index: 1;
}

.receipt-container .header h1 {
    color: #8B0000;
    font-size: 12px;
    margin: 2px 0;
    font-weight: 700;
    font-family: 'Short Stack', cursive;
}

.receipt-container .header p {
    margin: 1px 0;
    font-size: 8px;
    color: #666;
}

.receipt-container .receipt-title {
    text-align: center;
    margin: 5px 0;
    padding: 3px 0;
    background: linear-gradient(to right, #FFF0F0, #FFFFFF, #FFF0F0);
    border-radius: 3px;
    position: relative;
}

.receipt-container .receipt-title h2 {
    font-size: 10px;
    color: #8B0000;
    margin: 2px 0;
    display: flex;
    align-items: center;
    justify-content: center;
}

.receipt-container .receipt-title h2 i {
    margin: 0 2px;
    font-size: 8px;
}

.receipt-container .receipt-title p {
    font-size: 7px;
    color: #777;
    margin: 0;
}

.receipt-container .customer-info {
    margin: 5px 0;
    padding: 4px;
    background: #FFF5F5;
    border-radius: 3px;
    font-size: 9px;
}

.receipt-container .info-row {
    display: flex;
    justify-content: space-between;
    margin: 1px 0;
}

.receipt-container .info-label {
    color: #8B0000;
    font-weight: bold;
}

.receipt-container .items-table {
    width: 100%;
    border-collapse: collapse;
    margin: 5px 0;
    font-size: 9px;
}

.receipt-container .items-table th {
    background: #8B0000;
    color: white;
    padding: 2px;
    text-align: left;
    font-size: 8px;
}

.receipt-container .items-table td {
    padding: 1px 2px;
    border-bottom: 1px solid #FFD6D6;
}

.receipt-container .items-table tr:nth-child(even) {
    background-color: #FFF9F9;
}

.receipt-container .item-name {
    max-width: 100px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.receipt-container .item-qty, 
.receipt-container .item-price,
.receipt-container .item-total {
    text-align: center;
    width: 20%;
}

.receipt-container .total-section {
    margin-top: 5px;
    padding-top: 5px;
    border-top: 1px solid #8B0000;
    font-size: 10px;
}

.receipt-container .total-row {
    display: flex;
    justify-content: space-between;
    margin: 1px 0;
}

.receipt-container .grand-total {
    font-weight: bold;
    color: #8B0000;
    font-size: 11px;
    margin-top: 3px;
    padding-top: 3px;
    border-top: 1px solid #8B0000;
}

.receipt-container .footer {
    text-align: center;
    margin-top: 6px;
    padding-top: 5px;
    border-top: 1px solid #8B0000;
    font-size: 9px;
    color: #666;
}

.receipt-container .thank-you {
    color: #8B0000;
    font-weight: bold;
    font-size: 10px;
    margin: 3px 0;
    display: flex;
    align-items: center;
    justify-content: center;
}

.receipt-container .thank-you i {
    margin: 0 2px;
    color: #8B0000;
    font-size: 8px;
}

.receipt-container .footer p {
    margin: 2px 0;
    font-size: 8px;
}

.assigned-rider {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 15px;
}

.rider-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.rider-avatar {
    width: 40px;
    height: 40px;
    background: #8B0000;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 16px;
}

.rider-details h4 {
    margin: 0 0 4px 0;
    color: #333;
    font-size: 0.95rem;
}

.rider-details p {
    margin: 0;
    color: #666;
    font-size: 0.85rem;
}

.rider-id {
    font-size: 0.75rem;
    color: #999;
}

.rider-actions {
    display: flex;
    gap: 8px;
}

.no-rider {
    text-align: center;
    padding: 20px;
}

.no-rider-icon {
    font-size: 36px;
    color: #ccc;
    margin-bottom: 10px;
}

.no-rider p {
    color: #666;
    margin-bottom: 15px;
}

.btn {
    padding: 10px 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-weight: 500;
    transition: all 0.3s;
    font-size: 0.9rem;
    text-decoration: none;
}

.btn-primary {
    background: #8B0000;
    color: white;
}

.btn-primary:hover {
    background: #6d0000;
}

.btn-danger {
    background: #ff4757;
    color: white;
}

.btn-danger:hover {
    background: #ff3742;
}

.btn-secondary {
    background: #a4b0be;
    color: white;
}

.btn-secondary:hover {
    background: #747d8c;
}

.btn-outline {
    background: white;
    color: #8B0000;
    border: 1px solid #8B0000;
}

.btn-outline:hover {
    background: #f8f9ff;
}

.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    align-items: center;
    justify-content: center;
}

.modal-content {
    background-color: white;
    padding: 0;
    border-radius: 8px;
    width: 90%;
    max-width: 500px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
}

.modal-header {
    padding: 20px;
    border-bottom: 1px solid #e0e0e0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    margin: 0;
    color: #333;
}

.modal-close {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #666;
}

.modal-body {
    padding: 20px;
}

.modal-footer {
    padding: 20px;
    border-top: 1px solid #e0e0e0;
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.rider-selection-tabs {
    display: flex;
    border-bottom: 1px solid #e0e0e0;
    margin-bottom: 20px;
}

.tab-btn {
    flex: 1;
    padding: 12px;
    background: none;
    border: none;
    cursor: pointer;
    border-bottom: 2px solid transparent;
}

.tab-btn.active {
    border-bottom-color: #8B0000;
    color: #8B0000;
    font-weight: 600;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.search-box {
    position: relative;
    margin-bottom: 20px;
}

.search-box input {
    width: 100%;
    padding: 12px 40px 12px 15px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
}

.search-box i {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #666;
}

.riders-list {
    max-height: 300px;
    overflow-y: auto;
}

.rider-option {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    border: 1px solid #f0f0f0;
    border-radius: 8px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.rider-option:hover {
    border-color: #8B0000;
    background: #f8f9ff;
}

.rider-option.selected {
    border-color: #8B0000;
    background: #f0f4ff;
}

.rider-option-avatar {
    width: 40px;
    height: 40px;
    background: #ffe0e0;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #8B0000;
}

.rider-option-info {
    flex: 1;
}

.rider-option-info h4 {
    margin: 0 0 5px 0;
    color: #333;
}

.rider-option-info p {
    margin: 0;
    color: #666;
    font-size: 14px;
}

.rider-option-action {
    color: #666;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #333;
}

.form-control {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
}

.file-upload-area {
    border: 2px dashed #e0e0e0;
    border-radius: 8px;
    padding: 30px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.file-upload-area:hover {
    border-color: #8B0000;
    background: #f8f9ff;
}

.file-upload-area i {
    font-size: 24px;
    color: #666;
    margin-bottom: 10px;
}

.file-upload-area p {
    margin: 0 0 5px 0;
    color: #333;
}

.file-upload-area span {
    color: #666;
    font-size: 12px;
}

.file-name {
    margin-top: 10px;
    padding: 8px 12px;
    background: #f8f9fa;
    border-radius: 4px;
    font-size: 14px;
    display: none;
}

.alert {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 20px;
    border-radius: 8px;
    color: white;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: space-between;
    min-width: 300px;
    animation: slideIn 0.3s ease;
}

.alert-success {
    background: #28a745;
}

.alert-danger {
    background: #dc3545;
}

.alert .close {
    background: none;
    border: none;
    color: white;
    font-size: 16px;
    cursor: pointer;
    margin-left: 15px;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@media (max-width: 768px) {
    .invoice-content {
        grid-template-columns: 1fr;
    }
    
    .rider-section {
        position: static;
    }
    
    .invoice-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .header-actions {
        width: 100%;
        justify-content: space-between;
    }
    
    .assigned-rider {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }
    
    .rider-actions {
        width: 100%;
        justify-content: space-between;
    }
    
    .receipt-container {
        width: 100%;
        max-width: 240px;
    }
}

@media print {
    .invoice-header, .rider-section {
        display: none;
    }
    
    .order-invoice-container {
        padding: 0;
    }
    
    .receipt-section {
        box-shadow: none;
        border: none;
        padding: 0;
        width: 100%;
        display: flex;
        justify-content: center;
    }
    
    .invoice-content {
        grid-template-columns: 1fr;
        display: flex;
        justify-content: center;
    }
    
    .receipt-container {
        border: 2px solid #8B0000 !important;
        box-shadow: none !important;
        margin: 0 auto !important;
    }
}
</style>
{% endblock content %}